{% extends 'index.html' %}
{% load crispy_forms_tags %}
{% load imagekit %}
{% load static %}

{% block title %}
    <title>커모</title>
{% endblock %}

{% block content %}
    <!--네이버맵 자바스크립트 로딩-->
    {% include "core/navermap_script.html" %}
    <!--본문-->
    <section class="contact">
        <h1 class="text-center">{{ coffeemeeting.title }}</h1>
        <div class="libre-text-lg container">
            <div class="row col-sm-6">
                <h4>
                    작성자: {{ coffeemeeting.author }}
                </h4>

                {% for p in coffeemeeting.photos.all %}
                    {% if p.image %}
                        <img src="{{ p.image.url }}"/>
                    {% endif %}
                {% endfor %}

                <p class="libre-text-lg mb-50">
                    내용: <b>{{ coffeemeeting.content }}</b>
                </p>

                <p class="mb-50">
                    <b class="libre-text-lg">카페: {{ coffeemeeting.cafe }}</b><a target="_blank"
                                                                                href="{% url 'cafes:cafes-detail' coffeemeeting.cafe.id %}"
                                                                                class="lead">(카페 정보 보기)</a>
                </p>
                <!--네이버맵 뷰-->
                <div id="map" style="width:100%;height:400px;"></div>
                <script type="text/javascript">
                    let x = "{{ coffeemeeting.cafe.mapx }}"
                    let y = "{{ coffeemeeting.cafe.mapy }}"
                    let location_title = "<h3>{{ object.location }}</h3>"
                </script>
                <script type="text/javascript" src="{% static 'core/js/navermap_view.js' %}"></script>
                <p class="libre-text-lg mb-50">
                    날짜 및 시간: {{ coffeemeeting.meeting_date| date:"Y년 m월 d일 A h시 i분" }}
                </p>
                <p class="libre-text-lg mb-50">
                    최대 참여 가능인원:
                    {% with coffeemeeting.max_participants as max %}
                        {% if max == 0 %}
                            누구나
                        {% else %}
                            {{ max }}
                        {% endif %}
                    {% endwith %}
                </p>
                <p class="libre-text-lg mb-50"> 참여자:

                    {% for participant in coffeemeeting.participants.all %}
                        {% if participant.user.profile_pic %}
                            {% thumbnail "25x25" participant.user.profile_pic %}
                        {% endif %}

                        {{ participant.user.name }},
                    {% empty %} 아직 참여자가 없네요
                    {% endfor %}
                    ( {{ coffeemeeting.participants.count }} )명 <br>
                </p>
                <!--참여 메세지-->
                {% if messages %}
                    <ul class="messages">
                        {% for message in messages %}
                            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}

                <!--참여버튼-->
                <form action="{% url 'meetings:participate' pk=coffeemeeting.pk %}" method="post">{% csrf_token %}
                    {# FIXME: Participant중에 현재 user가 존재한다면 텍스트를 참여 취소로 바꿔야 한다. 취소시 alert창을 띄워야겠지.#}
                    <button id="btn-participate" class="btn btn-default center-block">참여</button>
                </form>
                <hr>
            </div>
            <!--댓글-->
            <div class="row col-sm-6">
                {% include 'comments/comment_view_create.html' with goto='meetings:coffee-meeting-detail' %}
            </div>

            <!--삭제/수정버튼-->
            {% if user.is_authenticated and user == coffeemeeting.author %}
                <div id="container-btn" class="container col-sm-6">
                    <a href="{% url 'meetings:coffee-meeting-update' pk=coffeemeeting.pk %}">
                        <button class="btn btn-default">수정하기</button>
                    </a>
                    <form method="post"
                          action="{% url 'meetings:coffee-meeting-delete' pk=coffeemeeting.pk %}"> {% csrf_token %}
                        <input type="submit" value="삭제하기" class="btn btn-default" style="display: inline"
                               onclick="return confirm('정말로 삭제하시겠습니까?')">
                    </form>

                </div>
            {% endif %}
        </div>
    </section>
{% endblock %}
<hr>
