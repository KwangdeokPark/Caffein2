{% extends 'index.html' %}
{% load static %}
{% load imagekit %}

{% block title %}
    <title>카페 리스트</title>
{% endblock %}
{% block style %}
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
          crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet"
          type="text/css">
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>
{% endblock %}
{% block content %}
    <div class="container" style="padding-top:150px; background-color: #fafafa;">
        <div class="text-center">
            <h2>카페 리스트</h2>
            <hr class="my-4">
            <p class="lead" style="margin-bottom: 20px;">지금까지 카페인에서 커모를 했던 카페들이에요!</p>
        </div>
        <div class="row text-center" style="margin-bottom: 30px;">
            <div class="col-sm-12">
                <a id="btn-pop" href="{% url 'cafes:cafes-list' %}?sort=popularity" class="btn" role="button">인기순</a>
                <a id="btn-recent" href="{% url 'cafes:cafes-list' %}?sort=recent" class="btn" role="button">최신순</a>
                <a id="btn-photo" href="{% url 'cafes:cafes-list' %}?sort=photo" class="btn" role="button">사진 많은 순</a>
                <a id="btn-random" href="{% url 'cafes:cafes-list' %}?sort=random" class="btn" role="button">랜덤랜덤</a>
            </div>
        </div>
        <div class="card-columns"
             style="@include media-breakpoint-only(lg) {column-count: 4;}
                @include media-breakpoint-only(xl) {column-count: 5;}">
            {% for cafe in cafes %}
                {% if request.user_agent.is_mobile %}
                    <div class="card mx-auto" style="width: 18rem; max-width: 80%;">
                {% else %}
                    <div class="card" style="width: 18rem;">
                {% endif %}
            <a href="{% url 'cafes:cafes-detail' cafe.pk %}">
                {% if cafe.photos.exists %}
                    <img class="card-img-top" src="{{ cafe.photos.all.0.image_thumb.url }}">
                {% else %}
                    <img class="card-img-top" src="{% static 'assets/img/default-cafe.jpg' %}">
                {% endif %}
            </a>
            <div class="card-body">
                <h5 class="card-title">{{ cafe.name }}</h5>
                {% if cafe.description %}
                    <p class="card-text">{{ cafe.description }}</p>
                {% else %}
                    <p class="card-text">아직 카페 설명이 없어요. 채워주세요!</p>
                {% endif %}
            </div>
            <div class="card-footer">
                <small class="text-muted">
                    {% if cafe.uploader.profile_pic %}
                        {% thumbnail "30x30" cafe.uploader.profile_pic %}
                    {% endif %}
                    {{ cafe.uploader.name }} 님이 등록한 카페입니다.
                </small>
            </div>
            </div>
            {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}

{% block javascript %}
    <script type="text/javascript">
        $(document).ready(function () {
            {% if request.GET.sort == 'popularity' %}
                $('#btn-pop').removeAttr("href");
                $('#btn-pop').addClass("btn-info");
            {% elif request.GET.sort == 'recent' %}
                $('#btn-recent').removeAttr("href");
                $('#btn-recent').addClass("btn-info");
            {% elif request.GET.sort == 'photo' %}
                $('#btn-photo').removeAttr("href");
                $('#btn-photo').addClass("btn-info");
            {% elif request.GET.sort == 'random' %}
                $('#btn-random').addClass("btn-info");
            {% endif %}
        });
    </script>
{% endblock %}